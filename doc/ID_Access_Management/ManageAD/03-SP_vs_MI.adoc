= 2-3. Service Principal vs Management ID

この文章は、Azure AD において、人間の従業員ではなく**アプリケーションやサービス**にアクセス権を与えるための ID の種類と、その必要性について説明しています。

== 📌 要点まとめ：サービスプリンシパルとマネージド ID

=== **人間以外の ID の必要性:**

* アプリケーションの実行に**従業員の資格情報（ユーザー ID/パスワード）**を使用すべきではありません。
* 従業員が退職などで資格情報が無効になった際に、そのアカウントを使用している**アプリケーションが動作を停止するのを防ぐ**ためです。

=== **ID の種類（アプリケーション/サービス向け）:**
1.  **サービスプリンシパル (Service Principal):**
** **ユーザーが管理する ID** に相当します。
** 手動で作成し、**ID とシークレット**（パスワード）を管理・設定する必要があります。
2.  **マネージド ID (Managed Identity) - システム割り当て:**
** **Azure が管理する ID** に相当します。
** リソース（例：Kubernetes）を作成する際に選択するだけで、Azure が自動的に ID を作成・管理するため、ユーザーがパスワードなどを管理する必要がありません。

=== **結論:**
アプリケーションや自動プロセスがリソースにアクセスする際には、人間のユーザーアカウントではなく、セキュリティと運用の安定性のために**サービスプリンシパル**または**マネージド ID**を使用することが必須です。

== 日本語情報

Azure Active Directory は、クラウド内の ID サービスです。通常、Azure AD を利用するのは、ユーザー ID とパスワード、場合によっては多要素認証や、ID を保護するために Azure AD が提供する追加サービスを使用して認証を行う、**実際の人間**（会社の従業員、パートナー、顧客など）です。彼らは自分が Azure AD を使っていることに気づいていないかもしれません。

しかし、「**サービスプリンシパル**」の概念は、基本的に**アプリケーション**や**コンピューティングリソース**が他のリソースにアクセスする必要があるという概念です。アプリケーションやコンピューティングサービスのために、**実際の従業員のユーザー資格情報**を使うことは避けるべきです。

例えば、ジョン・ドウさんがあなたの従業員だとして、このアプリケーションを実行するためにジョン・ドウさんのユーザー ID とパスワードを使うべきではありません。その理由は非常に単純です。ジョン・ドウさんが**いつまで**あなたの会社で働くかわからないからです。そして、例えばジョン・ドウさんが辞め、その資格情報が無効になった翌日に、**多数のアプリケーションが動作しなくなる**といった状況に陥ることは避けたいでしょう。

そのため、一般的に、アプリケーションにはシステム内で**独自の ID**を持たせたいと考えます。

しかし、その際、アプリケーションがユーザーになりすまして独自のユーザー ID とパスワードを持つことも、おそらく望ましくありません。それは物事を混乱させる可能性があります。ユーザーは多要素認証を必要としたり、パスワードの期限が切れたりすることがあるからです。

したがって、**アプリケーションや自動プロセス**の資格情報と**実際の人間**の資格情報とは、**別の概念**を持つことが本当に望ましいのです。

これが、「**サービスプリンシパル**」と「**マネージド ID**」の概念につながります。

これを実演するために、別のテナントに切り替えます。プロフィール画像をクリックし、ここにある「ディレクトリの切り替え」リンクも見えます。そして、**デフォルトのディレクトリ**に戻ります。これは、そちらにはサブスクリプションがあり、サービスプリンシパルを必要とするアプリケーションを作成するプロセスを実行できるからです。

ここで実演したいのは、Azure 内には、**サービスプリンシパル**または**マネージド ID** の作成を求められる場所が**複数**あるということです。

私にとって最も簡単な実演方法は Kubernetes Service です。

「リソースの作成」に進み、コンテナをホストするための**サーバークラスター**を作成します。Kubernetes が何であるかを理解しているかどうかは、実際には重要ではありません。これはコンピューティングリソースだと考えてください。

最初のタブのフィールドは入力せず、「**認証**」タブに直接切り替えます。

上部で、「**サービスプリンシパル**」または「**システム割り当てマネージド ID**」の概念を確認できます。これらは非常に似ていますが、それぞれに利点と欠点があります。

「**マネージド ID**」の概念を目にするかもしれません。これが「マネージド」である理由は、**Azure がこれを管理してくれる**からです。

* 「システム割り当てマネージド ID」を選択してリソースを作成すると、そのリソース専用の ID がシステム内に作成されます。そして、その ID に権限を付与できますが、その ID を選択したり、実質的な制御を行ったりすることはできません。それは舞台裏で行われる、このエンティティに権限を付与するようなものです。

一方、「**サービスプリンシパル**」の概念は、はるかに**手動**です。

* 「サービスプリンシパル」を選択すると、いくつかの ID とシークレットが表示されます。私は**サービスプリンシパルを事前に作成**し、その ID とシークレットを理解してここに貼り付ける必要があります。そうすることで、このクラスターがその ID を使用できるようになります。

つまり、**サービスプリンシパル**は実質的に**ユーザーが管理する ID**であり、**システム割り当てマネージド ID** は **Azure が提供**するものです。